# AUTOGENERATED! DO NOT EDIT! File to edit: 00_core.ipynb (unless otherwise specified).

__all__ = ['GH_HOST', 'GhApi']

# Cell
import jsonref,json
from fastcore.utils import *
from fastcore.foundation import *
from fastcore.meta import *
from urllib import request
import pprint,inspect
from inspect import signature,Parameter
from .build_lib import build_funcs, GH_DOC_URL
from .metadata import funcs

# Cell
GH_HOST = "https://api.github.com"
_DOC_URL = GH_DOC_URL

# Cell
class GhApi:
    def __init__(self, owner, repo, token):
        funcs_ = L(funcs).starmap(GhVerb, client=self)
        self._fs = {k:_GhVerbGroup(v) for k,v in groupby(funcs_, 'tag').items()}
        self._headers = { 'Authorization' : 'token ' + token,
                         'Accept': 'application/vnd.github.v3+json'}
        self.owner,self.repo = owner,repo
        self.repo_url = f"{GH_HOST}/repos/{owner}/{repo}"

    def __dir__(self): return super().__dir__() + list(self._fs)

    def __getattr__(self,k):
        if k in self._fs: return self._fs[k]
        raise AttributeError(k)

    def __call__(self, path, **data):
        "Call GitHub API `path`"
        path = f"{self.repo_url}{path}"
        return dict2obj(do_request(path, headers=self._headers, **data))